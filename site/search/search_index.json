{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"PowerController Application","text":"<p>The Power Controller is a Python-based automation tool that schedules and controls a power loads based on electricity pricing and a wide variety of user-configurable parameters and triggers. </p>"},{"location":"#features","title":"Features","text":"<ul> <li>Multiple output devices supported. </li> <li>Integrate with Amber Electric so that you can run a device (e.g. a pool pump) at the lowest possible rates.</li> <li>Supports switched outputs and meter only outputs.</li> <li>Integration with multiple Tesla vehicles to report on charging costs.</li> <li>Integrates with the majority of Shelly smart switches and energy meters to control and monitor you electrical devices.</li> <li>Dynamic Scheduling: Adjusts device operation based on real-time electricity prices.</li> <li>Normal scheduling: Turn devices on / off based on a time of day / day of week schedule, including support for dusk / dawn triggers. Schedule can be used for fall back if Amber pricing unavailable. Multiple schedules available.</li> <li>Override the output state using the webapp or an input line on a Shelly device.</li> <li>Support for complex output change sequences (e.g. turn on switch 1, wait for 20 seconds, turn on switch 2).</li> <li>Web app to view the current state of each device and manually override if needed. </li> <li>Integrate with a UPS and control and output based on the UPS's \"health\".</li> <li>Historical Tracking: Maintains past days of device runtime to optimize future scheduling.</li> <li>Integrates with the PowerControllerViewer app so that you can view and chart status and history of all your output devices and meters.</li> <li>Integrate with multiple temperature probes. Switch an output based on temperature thresholds. </li> <li>Set minimum, preferred and maximum operating times per day. Actual operating times are controlled by electicity prices and/or a predefined schedule. </li> <li>Vary preferred operating times each month (e.g. run your pool pump for longer in the summer).</li> <li>Email notification for critical errors and excess eneegy usage.</li> <li>Integration with the BetterStack uptime for heatbeat monitoring.</li> </ul>"},{"location":"#installation-and-configuration-guide","title":"Installation and Configuration Guide","text":"<p>The pages below will walk you through the process of installing and configuring the PowerController application.</p> <ul> <li>Instalation and Getting Started</li> <li>Configuration Guide</li> <li>Production Deployment</li> </ul>"},{"location":"features/","title":"Features","text":"<ul> <li>Multiple output devices supported. </li> <li>Integrate with Amber Electric so that you can run a device (e.g. a pool pump) at the lowest possible rates.</li> <li>Supports switched outputs and meter only outputs.</li> <li>Integration with multiple Tesla vehicles to report on charging costs.</li> <li>Integrates with the majority of Shelly smart switches and energy meters to control and monitor you electrical devices.</li> <li>Dynamic Scheduling: Adjusts device operation based on real-time electricity prices.</li> <li>Normal scheduling: Turn devices on / off based on a time of day / day of week schedule, including support for dusk / dawn triggers. Schedule can be used for fall back if Amber pricing unavailable. Multiple schedules available.</li> <li>Override the output state using the webapp or an input line on a Shelly device.</li> <li>Support for complex output change sequences (e.g. turn on switch 1, wait for 20 seconds, turn on switch 2).</li> <li>Web app to view the current state of each device and manually override if needed. </li> <li>Integrate with a UPS and control and output based on the UPS's \"health\".</li> <li>Historical Tracking: Maintains past days of device runtime to optimize future scheduling.</li> <li>Integrates with the PowerControllerViewer app so that you can view and chart status and history of all your output devices and meters.</li> <li>Integrate with multiple temperature probes. Switch an output based on temperature thresholds. </li> <li>Set minimum, preferred and maximum operating times per day. Actual operating times are controlled by electicity prices and/or a predefined schedule. </li> <li>Vary preferred operating times each month (e.g. run your pool pump for longer in the summer).</li> <li>Email notification for critical errors and excess eneegy usage.</li> <li>Integration with the BetterStack uptime for heatbeat monitoring.</li> </ul>"},{"location":"prod_deployment/","title":"Production Deployment","text":"<p>checklist </p>"},{"location":"running/","title":"Running and testing the app","text":""},{"location":"running/#log-files","title":"Log files","text":"<p>log files </p>"},{"location":"configuration/","title":"Configuration","text":"<p>The PowerController application is configured using the config.yaml file. An example Configuration File has been provided as part of the installation - you can copy this to config.yaml to get started. </p> <p>We recommend fully configuring the config file before attempting to run the application. When the app starts, it will do its best to validate the contents of the config file. That being said, some errors might not be reported until the app is fully running (see log files).</p> <p>You can edit config.yaml using nano:</p> <pre><code>nano config.yaml\n</code></pre> <p>...or you can copy it to a desktop system and use your favorite editor that include yaml syntax validation (we recommend VSCode with the redhat.vscode-yaml extension).</p> <p>The config file supports the following sections. Some of mandatory and some are optional. The same goes for the various keys in each section. The supported sections are outline below. A seperate help page has been provided for each one (click on the section name).</p> Section Description Required General General settings for the Power Controller application Yes Files Location of log and system state files Yes Email use this section here if you want to be emailed when there's a critical error or excessive energy use No Website Settings for the built-in web server that provides a web interface to view and control the outputs No AmberAPI Integration with the Amber Electric API to download real time energy prices for your home No ShellyDevices Describe the Shelly devices you want to control Yes Outputs Configure the behaviour of each outputs and/or meters that will control and monitor your electrical devices Yes OperatingSchedules Schedule used for switched outputs Yes OutputSequences Define a sequence of actions to perform on outputs when turning On or off No ViewerWebsite Integration with the PowerControllerViewer app No OutputMetering Logging of output energy consumption data to CSV and the system state file, as well as viewing and charting in the PowerControllerView application (if enabled) No TempProbeLogging Logging of temperature probes to CSV and the system state file, as well as viewing and charting in the PowerControllerView application (if enabled) No UPSIntegration Define one or more UPS units that can modify the behaviour of an Output No Location Specific the location of your home. Used to define dawn and dusk times in an operating schedule No TeslaMate Configure integration with the TeslaMate database to import Tesla charging session data No HeartbeatMonitor Integration with a Better Uptime heartbeat monitor to monitor uptime of the application No"},{"location":"configuration/example_config/","title":"Example Configuration File","text":"<p>This file (config_example.yaml) is available in the project root folder. You can use this as your starting point for the actual application configuration (config.yaml)</p> <pre><code># General settings for the Power Controller application\nGeneral:\n  Label: MyPower          # A label for this installation - used in the email subject and web viewer app\n  PollingInterval: 30     # Number of seconds to sleep between each check of the run plan and possible changes to outputs. Recommended 30 seconds.\n  # Some critical errors can trigger email notifications - for example the AmberAPI not responding. This is the time in minutes for an issue to \n  # persist before we send an email notification. Leave blank to disable.\n  ReportCriticalErrorsDelay: 30\n  DefaultPrice: 32.0      # A default price to use if the Amber API is not available and there is no schedule price defined  \n  ConsumptionDataFile: output_consumption_data.csv    # Output consumption data file - leave blank to disable\n  ConsumptionDataMaxDays: 30    # Maximum number of days to keep in the consumption data file. Set to -1 to disable truncation.\n\n\n# Settings for various log and state files\nFiles:\n  SavedStateFile: system_state.json    # The name of the saved state file. This is used to store the state of the device between runs.\n  LogfileName: logfile.log             # The name of the log file\n  LogfileMaxLines: 10000               # The maximum number of lines to keep in the log file\n  LogfileVerbosity: detailed           # How much information do we write to the log file. One of: none; error; warning; summary; detailed; debug; all\n  ConsoleVerbosity: detailed           # How much information do we write to the console. One of: error; warning; summary; detailed; debug; all\n\n\n# Enter your settings here if you want to be emailed when there's a critical error. Note that the SMTP username and password have been set in the .env file for security, but you can also set them here if you prefer.\nEmail:\n  EnableEmail: True                         # Set to True to enable email notifications \n  SendEmailsTo: &lt;Your email address here&gt;   # The email address to send notifications to\n  SMTPServer: &lt;Your SMTP server here&gt;       # The SMTP server to use to send the email\n  SMTPPort: 587                             # The SMTP server port\n  SubjectPrefix: \"[My PowerController]: \"   # A prefix to add to the email subject line\n\n\n# Settings for the built-in web server that provides a web interface to view and control the power controller\nWebsite:\n  HostingIP: 0.0.0.0          # The IP address to host the web server on. Use 0.0.0.0 to listen on all interfaces\n  Port: 8080                  # The port to host the web server on\n  PageAutoRefresh: 30         # How often to refresh the web page (in seconds). Set to 0 to disable auto-refresh.\n  AccessKey: &lt;Your website API key here&gt;   # An access key to secure the web interface. Alternatively, set the WEBAPP_ACCESS_KEY environment variable. Leave blank to disable access control.\n\n\n# Settings for the Amber API integration\nAmberAPI:\n  Mode: Live    # Operating mode for the Amber API: Live (attempt to download prices), Offline (pretend Amber API is offline, use cached prices). Disabled (fall back to schedule)\n  APIURL: https://api.amber.com.au/v1   # The base URL for the Amber API\n  APIKey: &lt;Your API key here&gt;    # The API key for your account, get one at app.amber.com.au/developers. Alternatively, set the AMBER_API_KEY environment variable.\n  RefreshInterval: 15       # How often to refresh the pricing data from Amber (in minutes) \n\n\n# Use this section to configure your Shelly devices\nShellyDevices:\n  ResponseTimeout: 3            # How long to wait in seconds for a response from a Shelly device\n  RetryCount: 1                 # Number of times to retry a request to a Shelly device if it fails\n  RetryDelay: 2                 # Number of seconds to wait between retries\n  MaxConcurrentErrors: 4        # Send an email notification if we get this number of concurrent errors\n  Devices:                      # List of Shelly devices to control\n    - Name: Shelly Pool 1        # A name for this device\n      Model: Shelly2PMG3        # The model of Shelly device\n      Hostname: 192.168.1.20   # The IP address or hostname of the Shelly device\n      Inputs:                   # List of inputs on the Shelly device to monitor\n        - Name: \"Filter Pump Override\"\n        - Name: \"Solar Pump Override\"\n      Outputs:                  # List of outputs on the Shelly device to control your devices\n        - Name: \"Filter Pump Power\"\n        - Name: \"Solar Pump Power\"\n      Meters:                  # List of meters on the Shelly device to monitor energy usage\n        - Name: \"Filter Pump Energy\"\n        - Name: \"Solar Pump Energy\"\n    - Name: Shelly Pool 2\n      Model: Shelly2PMG3        \n      Hostname: 192.168.1.21   \n      Simulate: False           \n      Outputs:                  \n        - Name: \"Solar Valve Actuator\"\n        - Name: \"Shelly Pool 2 O2\"\n      TempProbes: \n        - Name: \"Temp Pool Water\"\n          RequiresOutput: \"Filter Pump Power\"  # Only read this probe when the specified output is ON\n        - Name: \"Temp Solar Return\"\n          RequiresOutput: \"Solar Pump Power\"  # Only read this probe when the specified output is ON\n        - Name: \"Temp Roof\"\n    - Name: Spello Hot Water\n      Model: Shelly2PMG3\n      Hostname: 192.168.86.39\n      ExpectOffline: True       # Expect that this device will sometimes be offline and so don't report warnings when it happens\n      Outputs:\n        - Name: \"Hot Water O1\"\n        - Name: \"Hot Water O2\"\n      Meters:\n        - Name: \"Hot Water M1\"\n        - Name: \"Hot Water M2\"\n    - Name: Panel EM1\n      Model: ShellyEMG3\n      Hostname: 192.168.86.44\n      ExpectOffline: True\n      Meters:\n        - Name: \"Panel EM1.1\"\n        - Name: \"Panel EM1.2\"   \n    - Name: Network Rack\n      Model: Shelly2PMG3\n      Hostname: 192.168.86.30\n      Outputs:\n        - Name: \"Network Rack O1\"\n        - Name: \"Network Rack O2\"\n\n\n# Configure each switched output that controls your devices and how they behave\nOutputs:  \n  - Name: Pool Pump                 # A name for this output - used in the web interface  \n    Type: shelly                    # The type of output - shelly (default), teslamate or meter\n    DeviceOutput: Filter Pump Power  # The Shelly device output that controls this device - must match a Name in the ShellyDevices: Devices: Outputs section\n    Mode: BestPrice                 # Operating mode: BestPrice (run for target hours at best price), Schedule (run according to schedule only)\n    Schedule: Pool Pump             # The operating schedule to use when in Schedule mode - must match a Name in the OperatingSchedules section\n    ConstraintSchedule: Pool Heating  # An optional constraint schedule that limits when the output can run, even in BestPrice mode\n    AmberChannel: general           # The Amber pricing channel to use for this device, typically general or controlledLoad\n    DaysOfHistory: 7                # How many days of history to keep for this device\n    MinHours: 2                     # Minimum number of hours to run each day\n    MaxHours: 10                    # Maximum number of hours to run each day\n    TargetHours: 7                  # Target number of hours to run each day. Set to -1 to run for all hours that fall within best price or the schedule\n    MonthlyTargetHours:             # Override the TargetHours for a specific month of the year \n      January: 8\n      February: 8\n      June: 6\n      July: 6\n      August: 6\n      December: 8     \n    MaxShortfallHours: 4            # Maximum number of shortfall hours we can carry forward from previous days. Ignored if TargetHours is -1. Set to 0 to disable.\n    MaxBestPrice: 23.0              # The maximum price to run at when in BestPrice mode. \n    MaxPriorityPrice: 35.0          # The maximum price to run when we haven't run for the minimum number of hours yet.\n    DeviceMeter: Filter Pump Energy  # The Shelly device meter to use to track energy usage - must match a Name in the ShellyDevices: Devices: Meters section\n    MaxDailyEnergyUse: 6000         # Maximum energy use expected in Wh per day. An email warning will be sent if this is exceeded.\n    DeviceInput: Filter Pump Override   # Optional: The Shelly device input to used override the state of the output - must match a Name in the ShellyDevices: Devices: Inputs section\n    DeviceInputMode: TurnOn         # If a DeviceInput is specified, this controls how is is used. Ignore: Ignore the state of the inputs. TurnOn: Turn output on if input is off. TurnOff: Turn output off if input is on.\n    MinOnTime: 30                   # Minimum minutes to stay on once turned on\n    MinOffTime: 10                  # Minimum minutes to stay off (prevent rapid cycling). Cannot be set if MaxffTime is set.\n  - Name: Solar Heating\n    Type: shelly\n    DeviceOutput: Solar Pump Power\n    Mode: Schedule\n    Schedule: Pool Heating\n    AmberChannel: general\n    TargetHours: -1\n    MaxBestPrice: 23.0\n    MaxPriorityPrice: 35.0\n    DeviceMeter: Solar Pump Energy\n    ParentOutput: Pool Pump               # Optional: The name of a parent output that must be ON for this output to run\n    TurnOnSequence: Turn On Solar Pump    # Optional: Name of the output sequence to run when turning on this output\n    TurnOffSequence: Turn Off Solar Pump  # Optional: Name of the output sequence to run when turning off this output\n    MaxAppOnTime: 60               # If we turned this output on via the app, revert to auto after this number of minutes. Set to 0 to disable.\n    MaxAppOffTime: 60              # If we turned this output off via the app, revert to auto after this number of minutes. Set to 0 to disable.\n    TempProbeConstraints:       # Optional list of temperature probe constraints that must be met for the output to run\n      - TempProbe: Temp Roof\n        Condition: GreaterThan\n        Temperature: 32.0\n      - TempProbe: Temp Pool Water\n        Condition: LessThan\n        Temperature: 30.0    \n  - Name: Hot Water Heater\n    Type: shelly\n    DeviceOutput: Hot Water O1\n    Mode: BestPrice\n    Schedule: Hot Water\n    AmberChannel: controlledLoad\n    TargetHours: -1\n    MaxBestPrice: 23.0\n    MaxPriorityPrice: 30.0\n    DeviceMeter: Hot Water M1\n    HideFromWebApp: True      # If True, this output will not be shown in the built-in web app\n    HideFromViewerApp: True  # If True, this output will not be shown in the PowerControllerViewer app\n  - Name: Tesla\n    Type: teslamate\n    CarID: 1                   # The ID of the car in TeslaMate to control (this is usually 1 if you only have one car)\n    DaysOfHistory: 14            # How many days of history to keep for this device in the system state file\n    AmberChannel: general       # The Amber pricing channel to use for pricing this device, typically general or controlledLoad\n    Schedule: General           # The operating schedule to use for pricing this device when not using Amber pricing - must match a Name in the OperatingSchedules section\n  - Name: \"EM1.1 Living &amp; Beds\"\n    Type: meter\n    DeviceMeter: Panel EM1.1\n    Mode: BestPrice\n    Schedule: General\n    PowerOnThresholdWatts: 40\n    PowerOffThresholdWatts: 10\n    MinEnergyToLog: 20\n    HideFromViewerApp: True\n  - Name: \"EM1.2 Kitchen &amp; Laundry\"\n    Type: meter\n    DeviceMeter: Panel EM1.2\n    Mode: BestPrice\n    Schedule: General\n    PowerOnThresholdWatts: 40\n    PowerOffThresholdWatts: 10\n    MinEnergyToLog: 20\n    HideFromViewerApp: True\n  - Name: Network Rack\n    DeviceOutput: Network Rack O1\n    Mode: BestPrice\n    Schedule: General\n    AmberChannel: general\n    TargetHours: -1\n    MaxShortfallHours: 0\n    MaxBestPrice: 60.0\n    MaxPriorityPrice: 60.0\n    UPSIntegration: \n      UPS: APC UPS\n      ActionIfUnhealthy: TurnOn\n\n\n# Define the operating schedules for your devices. These are used to determine when a device is allowed to run when not using the Amber pricing data.\nOperatingSchedules:\n  - Name: Pool Pump           # A name for this schedule - used in the Outputs section\n    Windows:                  # List of time windows when the schedule is active\n      - StartTime: \"00:00\"\n        EndTime: \"07:30\"\n        DaysOfWeek: All       # Days of the week this window applies to - Mon, Tue, Wed, Thu, Fri, Sat, Sun or All. Multiple days can be specified separated by commas\n        Price: 20\n      - StartTime: \"07:30\"\n        EndTime: \"09:00\"\n        DaysOfWeek: All\n        Price: 16\n      - StartTime: \"09:00\"\n        EndTime: \"15:00\"\n        DaysOfWeek: All\n        Price: 13\n      - StartTime: \"15:00\"\n        EndTime: \"17:00\"\n        DaysOfWeek: All\n        Price: 33\n      - StartTime: \"17:00\"\n        EndTime: \"21:00\"\n        DaysOfWeek: All\n        Price: 51\n      - StartTime: \"21:00\"\n        EndTime: \"23:59\"\n        DaysOfWeek: All\n        Price: 22\n  - Name: Pool Heating\n    Windows: \n      - StartTime: \"10:00\"\n        EndTime: \"16:00\"\n        DaysOfWeek: All\n      - StartTime: \"22:00\"\n        EndTime: \"23:59\"\n        DaysOfWeek: All\n  - Name: Hot Water\n    Windows: \n      - StartTime: \"00:00\"\n        EndTime: \"14:00\"\n        DaysOfWeek: All\n        Price: 18\n      - StartTime: \"22:00\"\n        EndTime: \"23:59\"\n        DaysOfWeek: All\n        Price: 20\n\n\n# Use this to define a sequence of actions to perform on outputs when turning On or off\nOutputSequences:\n  - Name: \"Turn On Solar Pump\"\n    Description: \"Turn on the actuator valve, wait for 1 minute then turn on the solar booster pump\"\n    Timeout: 90\n    Steps:\n      - Type: CHANGE_OUTPUT\n        OutputIdentity: \"Solar Valve Actuator\"\n        State: True\n        Retries: 2\n        RetryBackoff: 1.0\n      - Type: SLEEP\n        Seconds: 60.0\n      - Type: CHANGE_OUTPUT\n        OutputIdentity: \"Solar Pump Power\"\n        State: True\n        Retries: 2\n        RetryBackoff: 1.0\n  - Name: \"Turn Off Solar Pump\"\n    Description: \"Turn off the solar booster pump, wait for 10 seconds then turn off the actuator valve\"\n    Timeout: 30\n    Steps:\n      - Type: CHANGE_OUTPUT\n        OutputIdentity: \"Solar Pump Power\"\n        State: False\n        Retries: 2\n        RetryBackoff: 1.0\n      - Type: SLEEP\n        Seconds: 10.0\n      - Type: CHANGE_OUTPUT\n        OutputIdentity: \"Solar Valve Actuator\"\n        State: False\n        Retries: 2\n        RetryBackoff: 1.0\n\n\n# Use this section to configure integration with the PowerControllerViewer app - see https://github.com/NickElseySpelloC/PowerControllerViewer\nViewerWebsite:\n  Enable: False                   # Set to True to enable integration with the PowerControllerViewer app\n  BaseURL: http://localhost:8000  # The base URL of the PowerControllerViewer app\n  AccessKey: &lt;Your website API key here&gt;  # The access key for the PowerControllerViewer app. Alternatively, set the VIEWER_ACCESS_KEY environment variable.\n  APITimeout: 5                   # How long to wait in seconds for a response from the PowerControllerViewer app\n  Frequency: 10                   # How often to post the state to the web viewer app (in seconds)\n\n\n# Optionally use this section to enable logging of output energy consumption data to CSV and the system state file\nOutputMetering:\n  Enable: True    # Set to True to enable logging of output energy consumption data\n  DataFile: logs/output_consumption_data.csv     # Record to CSV data file. Required\n  OutputsToLog:   # A list of outputs to log. These must have a meter associated with them (Outputs: [Item]: DeviceMeter field)\n    - Output: Pool Pump\n      DisplayName: Pool\n    - Output: Solar Heating\n      DisplayName: Solar\n      HideFromViewerApp: True   # If True, exclude this output from the viewer app's metering display page\n    - Output: Hot Water Heater\n      DisplayName: Hot Water\n    - Output: Tesla\n    - Output: \"EM1.1 Living &amp; Beds\"\n      DisplayName: \"Living &amp; Beds\"\n    - Output: \"EM1.2 Kitchen &amp; Laundry\"\n      DisplayName: \"Kitchen &amp; Laundry\"\n\n\n# Optionally enable temperature probe logging. The temperature probes must be defined in the Shelly device configuration above.\nTempProbeLogging:\n    Enable: True\n    Probes:   # A list of temp probes to monitor.\n      - Name: Temp Pool Water\n        DisplayName: Pool Water\n        Colour: Blue  # Colour to use when charting this probe\n      - Name: Temp Roof\n      - Name: Temp Solar Return\n        HideFromViewerApp: True      # If True, probe will be logged in CSV file but hidden from the PowerControllerViewer app\n    LoggingInterval: 30  # Log temp probe readings every N minutes\n    LastReadingWithinMinutes: 180  # Only log readings that have been updated within this number of minutes. 0 to disable.\n    SavedStateFileMaxDays: 7  # Number of days to keep in the data in the system state file. Try to keep this as low as possible to reduce file size. 0 to disable.\n    HistoryDataFile: temp_probe_history.csv  # Leave blank to disable logging to a CSV file.\n    HistoryDataFileMaxDays: 90  # Maximum number of days to keep in the history data file.  0 to disable.\n    Charting:   # This contains settings for generating temperature charts for the PowerControllerViewer website.\n      Enable: True\n      Charts:\n        - Name: \"Pool Temps\"\n          Probes:\n            - Temp Pool Water\n            - Temp Solar Return\n          DaysToShow: 30\n        - Name: \"Roof Temp\"\n          Probes:\n            - Temp Roof\n          DaysToShow: 30\n\n\n# Optionally use this section to configure integration with your UPS to monitor its runtime and battery charge levels. See README for more details.\nUPSIntegration:\n  - Name: APC UPS\n    Script: shell_scripts/apc_ups_runtime.sh\n    MinRuntimeWhenDischarging: 300   # Minimum runtime remaining in seconds to when UPS is discharging to consider the UPS as \"healthy\". \n    MinChargeWhenDischarging: 10   # Minimum charge remaining in percent when discharging to consider the UPS as \"healthy\".\n    MinRuntimeWhenCharging:     # Minimum runtime remaining in seconds to when UPS is charging to consider the UPS as \"healthy\". \n    MinChargeWhenCharging: 80   # Minimum charge remaining in percent when charging to consider the UPS as \"healthy\".\n\n\n# Optionally use this section to specify the geographic location and timezone of your installation. This is used to determine the dawn and dusk times for scheduled events.\nLocation:\n  Timezone: Europe/London     # See https://en.wikipedia.org/wiki/List_of_tz_database_time_zones\n\n\n# Optionally use this sectionto configure integration with the TeslaMate database to import Tesla charging session data\nTeslaMate:\n  Enable: True           # Set to True to enable integration with the TeslaMate database\n  RefreshInterval: 10     # How often to refresh the TeslaMate data (in minutes)\n  Host: 127.0.0.1         # The host address of the TeslaMate database (or use the TESLAMATE_DB_HOST environment variable)\n  Port: 5432              # The port number of the TeslaMate database (or use the TESLAMATE_DB_PORT environment variable)\n  DatabaseName: teslamate # The name of the TeslaMate database (or use the TESLAMATE_DB_NAME environment variable)\n  DBUsername: teslamate   # The username to connect to the TeslaMate database (or use the TESLAMATE_DB_USER environment variable)\n  DBPassword: &lt;Your password here&gt;  # The password to connect to the TeslaMate database (or use the TESLAMATE_DB_PASSWORD environment variable)\n\n</code></pre>"},{"location":"configuration/sections/amber_api/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"configuration/sections/email/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"configuration/sections/files/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"configuration/sections/general/","title":"Configuration file - General section","text":"<p>General settings for the Power Controller application.</p> Key Description Label The label (name) that your installation. Used in the email subject and web viewer app PollingInterval Number of seconds to sleep between each check of the run plan and possible changes to outputs. Recommended 30 seconds or more. ReportCriticalErrorsDelay Some critical errors can trigger email notifications - for example the AmberAPI not responding. This is the time in minutes for an issue to persist before we send an email notification. Leave blank to disable. PrintToConsole Print some basic information to the console during startup and operation DefaultPrice A default price to use if the Amber API is not available and there is no schedule price defined"},{"location":"configuration/sections/heartbeat_monitor/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"configuration/sections/location/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"configuration/sections/operating_schedules/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"configuration/sections/output_metering/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"configuration/sections/output_sequences/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"configuration/sections/outputs/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"configuration/sections/shelly_devices/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"configuration/sections/temp_probe_logging/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"configuration/sections/teslamate/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"configuration/sections/ups_integration/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"configuration/sections/viewer_website/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"configuration/sections/website/","title":"Configuration file - xx section","text":"<p>desciption</p> <p>table</p>"},{"location":"installation/","title":"Getting Started and Installation","text":"<p>PowerController is primarily designed to be run on either a Linux system, A RaspberryPi or an Apple Mac (Intel or Apple Silicon). Earlier versions have been tested on Windows 11 and since this is a Python application, this should still work, but the installation steps below will need to be adjusted.</p> <p>Installation comes in several phases: </p> <ol> <li>Install the Prerequisites (Python, git, UV)</li> <li>Prepare your Shelly devices</li> <li>Install the PowerController application</li> <li>Configure the PowerController application</li> </ol>"},{"location":"installation/#next-step-install-the-prerequisites","title":"Next Step &gt;&gt; Install the Prerequisites","text":""},{"location":"installation/install_app/","title":"Installing the PowerController Application","text":"<p>The application installation instructions are generally the same for Linux, macOS and CentOS (RaspberryPi). Start a new terminal window on your target system and select parent folder that we'll create the installation folder in. In our example below, we'll use ~/apps folder for our user nick (/home/nick/apps)</p>"},{"location":"installation/install_app/#step-1-validate-that-the-prerequisites-are-properly-installed","title":"Step 1: Validate that the prerequisites are properly installed","text":"<p>Run the following commands. If any of them fail, or the python version is less than 3.13.0 please go back and review the prerequisite installation section again.</p> <pre><code>python3 --version\ngit --version\nuv --version\n</code></pre>"},{"location":"installation/install_app/#step-2-download-the-app-from-github","title":"Step 2: Download the app from GitHub","text":"<p>Create a folder for the app</p> <pre><code>cd ~/apps\nmkdir PowerController\ncd PowerController\n</code></pre> <p>Clone the app from GitHub</p> <pre><code>git clone https://github.com/NickElseySpelloC/PowerController.git .\n</code></pre> <p>Use UV to initialise the application and download all the supporting libraries</p> <pre><code>uv sync\n</code></pre> <p>Watch the uv sync command and make sure there are no errors reported. If all's well, activate the Python virtual environment and make sure we're using the right version of Python:</p> <pre><code>source .venv/bin/activate\nuv python pin 3.13\n</code></pre>"},{"location":"installation/install_app/#step-3-create-the-default-config-file","title":"Step 3: Create the default config file","text":"<p>An example configuration file has been provided for you in the application's root folder (config_example.yaml). Use this as a starting point for your config file:</p> <pre><code>cp config_example.yaml config.yaml\n</code></pre>"},{"location":"installation/install_app/#step-4-create-a-env-file-for-secure-credentials","title":"Step 4: Create a .env file for secure credentials","text":"<p>If you plan on using the following features: - Integration with Amber Electric for energy pricing - Email notification of application errors or excessive energy use - Secure integration with the PowerControllerViewer app - Stronger protection for the PowerController web application - Tesla charging integration</p> <p>Then we recommend creating a .env file to hold passwords and API keys. For now, let's create a file and store your email account SMTP username and password:</p> <pre><code>nano .env\n\n\n# In nano, create the following entries, save and exit:\nSMTP_USERNAME=&lt;SMTP username here&gt;\nSMTP_PASSWORD=&lt;SMTP password here&gt;\n</code></pre> <p>You're now ready to edit config.yaml and setup the configuration for your installation.</p>"},{"location":"installation/install_app/#next-step-configure-the-app","title":"Next Step &gt;&gt; Configure the App","text":""},{"location":"installation/prerequisites/","title":"Installing the Prerequisites","text":"<p>The prerequisites for the PowerController application are:</p> <ol> <li>Python v3.13</li> <li>UV package manager</li> </ol> <p>We'll step you through each of these in turn:</p>"},{"location":"installation/prerequisites/#step-1-checking-and-installing-python-v313","title":"STEP 1: Checking and installing Python v3.13","text":"<p>Check to see which version of Python is installed:</p> <pre><code>python3 --version\n</code></pre> <p>If Python 3.13 is installed, you should see something like:</p> <pre><code>Python 3.13.x\n</code></pre> <p>If the command is not found, or the version is lower than 3.13, install python3 using one of the sections below</p>"},{"location":"installation/prerequisites/#installing-python-v313-on-linux","title":"Installing Python v3.13 on Linux","text":"<p>We'll use apt to install Python 3.13 on Linux</p> <pre><code>sudo apt update\nsudo apt install python3.13 python3.13-venv python3.13-dev\n</code></pre>"},{"location":"installation/prerequisites/#installing-python-v313-on-macos","title":"Installing Python v3.13 on macOS","text":"<p>We'll use Homebrew to install Python 3.13 on a Mac</p> <p>Check if Homebrew is installed</p> <pre><code>brew --version\n</code></pre> <p>If Homebrew is not installed, install it with:</p> <pre><code>/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\n</code></pre> <p>After installation, restart your terminal.</p> <p>Install Python 3.13</p> <pre><code>brew update\nbrew install python@3.13\n</code></pre> <p>Ensure Python 3.13 is being used</p> <pre><code>brew link python@3.13 --force\n</code></pre> <p>Verify that v3.13 is not the default:</p> <pre><code>python3 --version\n</code></pre>"},{"location":"installation/prerequisites/#installing-python-v313-on-a-raspberrypi","title":"Installing Python v3.13 on a RaspberryPi","text":"<p>As at the time of writing, Python 3.13 compiled binaries aren't yet available for the Pi, so you will need to compile them from the source code using this guide.</p>"},{"location":"installation/prerequisites/#step-2-install-git","title":"STEP 2: Install git","text":"<p>git is needed to download the PowerController app from GitHub. Check if git is installed</p> <pre><code>git --version\n</code></pre> <p>If it's not installed, follow the steps below.</p>"},{"location":"installation/prerequisites/#installing-git-on-linux-and-raspberrypi","title":"Installing git on Linux and RaspberryPi","text":"<pre><code>sudo apt update\nsudo apt install git\n</code></pre>"},{"location":"installation/prerequisites/#installing-git-on-macos","title":"Installing git on macOS","text":"<pre><code>brew install git\n</code></pre>"},{"location":"installation/prerequisites/#step-3-install-the-uv-package-manager","title":"STEP 3: Install the UV package manager","text":"<p>uv is extremely fast and replaces tools like pip, venv, and pip-tools.</p>"},{"location":"installation/prerequisites/#installing-uv-on-linux-and-raspberrypi","title":"Installing UV on Linux and RaspberryPi","text":"<pre><code>curl -LsSf https://astral.sh/uv/install.sh | sh\n</code></pre> <p>Restart your terminal session, then verify:</p> <pre><code>uv --version\n</code></pre>"},{"location":"installation/prerequisites/#installing-uv-on-macos","title":"Installing UV on macOS","text":"<pre><code>brew install uv\n\n# Verify installation:\nuv --version\n</code></pre>"},{"location":"installation/prerequisites/#ensuring-uv-is-on-your-path","title":"Ensuring uv is on Your PATH","text":"<p>If uv installs but the command is not found, add this to your shell profile (~/.bashrc, ~/.zshrc, etc.):</p> <pre><code>export PATH=\"$HOME/.local/bin:$PATH\"\n</code></pre> <p>Then reload:</p> <pre><code># Reload ZShell\nsource ~/.zshrc\n\n# Reload bash\nsource ~/.bashrc\n</code></pre>"},{"location":"installation/prerequisites/#next-step-setup-your-shelly-devices","title":"Next Step &gt;&gt; Setup your Shelly devices","text":""},{"location":"installation/raspberry_pi_python/","title":"Build and Install Python 3.13 on a RaspberryPi","text":"<p>PowerController requires Python v3.13 or later. As at the time of writing, compiled binaries aren't yet available for the Pi, so you will need to compile them from the source code. We recommend a Pi with a good amount of free memory and swap space. </p>"},{"location":"installation/raspberry_pi_python/#check-available-ram-and-swap","title":"Check available RAM and swap","text":"<pre><code>free -h\n</code></pre> <p>If available RAM is low (&lt;100 MB), consider increasing swap:</p> <pre><code>sudo dphys-swapfile swapoff\nsudo nano /etc/dphys-swapfile\n\n# Set CONF_SWAPSIZE=2048 (or higher)\nsudo dphys-swapfile setup\nsudo dphys-swapfile swapon\n</code></pre> <p>Now build python 3.13 from source. This will install Python as /usr/local/bin/python3.13.</p> <pre><code>sudo apt update\n\nsudo apt install -y make build-essential libssl-dev zlib1g-dev \\\n  libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm \\\n  libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev \\\n  libffi-dev liblzma-dev\n\ncd /usr/src\nsudo wget https://www.python.org/ftp/python/3.13.0/Python-3.13.0.tgz\nsudo tar xzf Python-3.13.0.tgz\n\ncd Python-3.13.0\nsudo ./configure --enable-optimizations\nsudo make -j $(nproc)\nsudo make altinstall\n</code></pre> <p>\u26a0\ufe0f Use make altinstall so you don\u2019t overwrite the system Python.</p>"},{"location":"installation/shelly_setup/","title":"Setup your Shelly devices","text":"<p>PowerController requires at least one Shelly device to operate. You can run the application in simulation mode for testing, but to actually control and/or meter an electrical device, you'll need at least one Shelly device installed and configured. Shelly make a wide range of home automation products. PowerController supports the majority of Shelly's smart switches and energy meters that support WiFi or Ethernet connectivity.</p> <ol> <li>Install your device(s) according to Shelly's installation instructions. <ul> <li>Get help from a licensed electrician if you're uncomfortable doing this work yourself. </li> <li>You must connect the device to your network via WiFi or Ethernet (PowerController doesn't support Bluetooth, Z-Wave or Zigbee only devices at this time)</li> </ul> </li> <li>Use the Shelly app to make sure the device is working as intended. </li> <li>Please do not create any Actions for the device (these might conflict with the app's control of the device).</li> <li>In the app, go to Settings &gt; Device Information and make a note of the following:<ul> <li>Device IP address (e.g. 192.168.86.21)</li> <li>Device Type (e.g. Shelly Plus 2 PM)</li> </ul> </li> <li>Lookup the device type in models library and make a note of the model identifier (e.g. ShellyPlus2PM). Here's the entry for our example:</li> </ol> <pre><code>    {\n      \"model\": \"ShellyPlus2PM\",\n      \"name\": \"Shelly Plus 2PM\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen2/ShellyPlus2PM\",\n      \"generation\": 2,\n      \"protocol\": \"RPC\",\n      \"inputs\": 2,\n      \"outputs\": 2,\n      \"meters\": 2,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n</code></pre>"},{"location":"installation/shelly_setup/#unsupported-device","title":"Unsupported device","text":"<p>If you've bought a Shelly smart switch or energy meter and are having problems getting it to work, you can try modifying the shelly_models.json file included with the sc_utility library to add or update your devie. Alternatively, please contact Nick Elsey for support.</p>"},{"location":"installation/shelly_setup/#next-step-install-powercontroller","title":"Next Step &gt;&gt; Install PowerController","text":""}]}