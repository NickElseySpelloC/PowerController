<!doctype html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Lights</title>
<style>
  body {
    font-family: -apple-system, system-ui, Segoe UI, Roboto, sans-serif;
    margin: 16px;
  }

  .card {
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 12px 14px;
    margin-bottom: 12px;
  }

  .row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
  }

  button {
    padding: 10px 12px;
    border: none;
    border-radius: 999px;
    background: #eee;
  }

  button.active {
    background: #2ecc71;
    color: #fff;
  }

  .pill {
    padding: 6px 10px;
    border-radius: 999px;
    background: #eee;
    font-size: 12px;
  }

  .on {
    background: #2ecc71;
    color: #fff;
  }

  .off {
    background: #e74c3c;
    color: #fff;
  }
</style>
<div id="list"></div>
<script>
  async function fetchLights() {
    const res = await fetch('/api/lights');
    return await res.json();
  }
  async function setMode(id, mode) {
    await fetch(`/api/lights/${id}/mode`, {
      method: 'POST', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ mode })
    });
    render();
  }
  function pill(is_on) { return `<span class="pill ${is_on ? 'on' : 'off'}">${is_on ? 'ON' : 'OFF'}</span>`; }
  async function render() {
    const data = await fetchLights();
    const list = document.getElementById('list');
    list.innerHTML = Object.values(data).map(s => `
    <div class="card">
      <div class="row">
        <div>
          <div style="font-weight:600">${s.name}</div>
          <div style="opacity:0.7;font-size:12px">Mode: ${s.mode.toUpperCase()} &nbsp; ${pill(s.is_on)}</div>
        </div>
        <div class="row">
          <button class="${s.mode === 'on' ? 'active' : ''}"  onclick="setMode('${s.light_id}','on')">On</button>
          <button class="${s.mode === 'off' ? 'active' : ''}" onclick="setMode('${s.light_id}','off')">Off</button>
          <button class="${s.mode === 'auto' ? 'active' : ''}" onclick="setMode('${s.light_id}','auto')">Auto</button>
        </div>
      </div>
    </div>
  `).join('');
  }
  render();
  setInterval(render, 4000);
</script>